<!DOCTYPE html [<!ENTITY nbsp "&#160;">]>
<html t:type="graphene/layout" xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<title>HTML5 localStorage events sharing demo</title>
		<meta name="description"
			content="HTML 5 demo of how to share localStorage across windows" />
		<meta name="keywords" content="html 5 localStorage, localStorage events" />
		<style>
			#event-data { float:left; border: 1px solid #c0c0c0; padding: 9px; width:
			410px;}
			#data { float:left; border: 1px solid #c0c0c0; padding: 9px; width:
			410px;}
			#status { float:left;}
		</style>
	</head>
	<body>
		<div id="container">
			<div class="inner-container">
				<div class="box box-50">
					<div class="boxin">
						<div class="header">
							<h3>HTML5 localStorage sharing</h3>
						</div>
						<div class="content">
							<ul class="simple">
								<li class="even">
									<span id="status" style="color: rgb(9, 127, 26);">Your browser supports
										'localStorage'.</span>
								</li>
								<li class="odd">
									<span style="float: left; margin-right: 10px;">Input data :</span>
									<input id="data" value="" placeholder="Enter some text here..." />
								</li>
								<li class="even">
									<span id="event-data">Waiting for data from the other window...</span>
								</li>
								<li class="odd">
									<input type="checkbox" id="data1" />
									Shareable Checkbox
									<br />
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript">

			/* As this is only a proof of concept example, the code is a quick hack
			and leaves a lot to be desired. It can be imporved by an order of
			magnitude.
			*/
			var data = document.getElementById('data');
			var data1 = document.getElementById('data1');
			var output = document.getElementById('event-data');

			function displayStorageEvent(e) {
			if (e.key == 'storage-event') {
			output.innerHTML = e.newValue;
			}

			if (e.key == 'dataitem') {
				if(e.newValue === "true")
					data1.checked = true;
				else
					data1.checked = false;
				}
			}

			function updateStorageEvent() {
			localStorage.setItem('storage-event', this.value);
			}

			function updateClickEvent(e) {
			localStorage.setItem('dataitem', e.target.checked);
			}

			function init()
			{
			if (window.localStorage) {
			document.getElementById('status').innerHTML = "Your browser supports 'localStorage'.";
			document.getElementById("status").style.color = "#097F1A";

			// add a storage event listener for this origin
			if (window.addEventListener) {
			window.addEventListener("storage", displayStorageEvent, true);
			data.addEventListener("keyup", updateStorageEvent, true);
			data1.addEventListener("click", updateClickEvent, true);
			} else {
			window.attachEvent("storage", displayStorageEvent);
			data.attachEvent("keyup", updateStorageEvent);
			data1.attachEvent("click", updateClickEvent);
			}

			} else {
			document.getElementById('status').innerHTML = "Your browser dows not support 'localStorage'.";
			document.getElementById("status").style.color = "#FF1144";
			}
			}

			init();

		</script>

	</body>
</html>